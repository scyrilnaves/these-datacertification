# Copyright 2019 Cargill Incorporated
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
apiVersion: v1
kind: List

items:

# --------------------------=== pod 0 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-0
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-0
    template:
      metadata:
        labels:
          name: sawtooth-0
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "125Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -v --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "375Mi"
                # cpu: "0.5"
                ephemeral-storage: "375Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -v -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml

            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 15
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -v -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"

          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                #cpu: "0.5"
                ephemeral-storage: "1500Mi"
              limits:
                memory: "11Gi"
                #cpu: "1.1"
                ephemeral-storage: "2Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            envFrom:
              - configMapRef:
                  name: keys-config
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft0priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft0pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  if [ ! -e /root/.sawtooth/keys/my_key.priv ]; then
                    sawtooth keygen my_key
                  fi &&
                  if [ ! -e config-genesis.batch ]; then
                    sawset genesis -k /root/.sawtooth/keys/my_key.priv -o config-genesis.batch
                  fi &&
                  sleep 30 &&
                  echo sawtooth.consensus.pbft.members=["\"$pbft0pub\",\"$pbft1pub\",\"$pbft2pub\",\"$pbft3pub\",\"$pbft4pub\",\"$pbft5pub\",\"$pbft6pub\",\"$pbft7pub\""] &&
                  if [ ! -e config.batch ]; then
                    sawset proposal create \
                      -k /root/.sawtooth/keys/my_key.priv \
                      sawtooth.consensus.algorithm.name=pbft \
                      sawtooth.consensus.algorithm.version=1.0\
                      sawtooth.consensus.pbft.members=["\"$pbft0pub\",\"$pbft1pub\",\"$pbft2pub\",\"$pbft3pub\",\"$pbft4pub\",\"$pbft5pub\",\"$pbft6pub\",\"$pbft7pub\""] \
                      sawtooth.publisher.max_batches_per_block=100 \
                      sawtooth.cartp.factory.members='[\"02a47084f6228bf7eb91e1628140f5b717cad1d1166b4ad7665e88204e74f92e5c\"]' \
                      -o config.batch
                  fi && \
                  if [ ! -e /var/lib/sawtooth/genesis.batch ]; then
                    sawadm genesis config-genesis.batch config.batch
                  fi &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-0
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "50Mi"
                # cpu: "125m"
                ephemeral-storage: "200Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -v -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-0
            persistentVolumeClaim:
            claimName: sawtooth-data-0


- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-0
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-0
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800


# --------------------------=== pod 1 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-1
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-1
    template:
      metadata:
        labels:
          name: sawtooth-1
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "125Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -v --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "375Mi"
                # cpu: "0.5"
                ephemeral-storage: "375Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -v -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml

            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 15
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -v -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"
          
          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                # cpu: "0.5"
                ephemeral-storage: "1500Mi"
              limits:
                memory: "11Gi"
                # cpu: "1.1"
                ephemeral-storage: "2Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft1priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft1priv
              - name: pbft1pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft1pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft1priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft1pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_1_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-1
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "50Mi"
                # cpu: "125m"
                ephemeral-storage: "200Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -v -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-1
            persistentVolumeClaim:
            claimName: sawtooth-data-1
- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-1
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-1
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800

# --------------------------=== pod 2 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-2
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-2
    template:
      metadata:
        labels:
          name: sawtooth-2
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "125Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -v --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "375Mi"
                # cpu: "0.5"
                ephemeral-storage: "375Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -v -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml

            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 30
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -v -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"

          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                # cpu: "0.5"
                ephemeral-storage: "1500Mi"
              limits:
                memory: "11Gi"
                # cpu: "1.1"
                ephemeral-storage: "2Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft2priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft2priv
              - name: pbft2pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft1pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft2priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft2pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_2_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_1_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-2
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "50Mi"
                # cpu: "125m"
                ephemeral-storage: "200Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -v -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-2
            persistentVolumeClaim:
            claimName: sawtooth-data-2

- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-2
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-2
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800


# --------------------------=== pod 3 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-3
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-3
    template:
      metadata:
        labels:
          name: sawtooth-3
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "125Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -v --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "375Mi"
                # cpu: "0.5"
                ephemeral-storage: "375Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -v -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml

            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 15
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -v -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"

          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 


          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                # cpu: "0.5"
                ephemeral-storage: "1500Mi"
              limits:
                memory: "11Gi"
                # cpu: "1.1"
                ephemeral-storage: "2Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft3priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft3priv
              - name: pbft3pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft3pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft3priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft3pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_3_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_1_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_2_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-3
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "50Mi"
                # cpu: "125m"
                ephemeral-storage: "200Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -v -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-3
            persistentVolumeClaim:
            claimName: sawtooth-data-3

- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-3
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-3
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800


# --------------------------=== pod 4 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-4
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-4
    template:
      metadata:
        labels:
          name: sawtooth-4
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "125Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -v --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "375Mi"
                # cpu: "0.5"
                ephemeral-storage: "375Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -v -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml
            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 15
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -v -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"

          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                # cpu: "0.5"
                ephemeral-storage: "1500Mi"
              limits:
                memory: "11Gi"
                # cpu: "1.1"
                ephemeral-storage: "2Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft4priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft4priv
              - name: pbft4pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft4pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft4priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft4pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_4_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_1_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_2_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_3_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-4
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "50Mi"
                # cpu: "125m"
                ephemeral-storage: "200Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -v -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-4
            persistentVolumeClaim:
            claimName: sawtooth-data-4

- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-4
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-4
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800


# --------------------------=== pod 5 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-5
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-5
    template:
      metadata:
        labels:
          name: sawtooth-5
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "125Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -v --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.2"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "375Mi"
                # cpu: "0.5"
                ephemeral-storage: "375Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -v -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml
            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 15
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -v -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "25Mi"
                # cpu: "25m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "37Mi"
                # cpu: "35m"
                ephemeral-storage: "50Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"

          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "250Mi"
              limits:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "500Mi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                #cpu: "0.5"
                ephemeral-storage: "1500Mi"
              limits:
                memory: "11Gi"
                # cpu: "1.1"
                ephemeral-storage: "2Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft5priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft5priv
              - name: pbft5pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft5pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft5priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft5pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_5_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_1_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_2_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_3_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_4_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-5
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "50Mi"
              limits:
                # memory: "50Mi"
                # cpu: "125m"
                ephemeral-storage: "200Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -v -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-5
            persistentVolumeClaim:
            claimName: sawtooth-data-5

- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-5
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-5
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800


# --------------------------=== pod 6 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-6
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-6
    template:
      metadata:
        labels:
          name: sawtooth-6
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "500Mi"
                # cpu: "1"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -vv --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "500Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "750Mi"
                # cpu: "1"
                ephemeral-storage: "750Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -vv -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml

            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 15
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "100Mi"
              limits:
                # memory: "75Mi"
                # cpu: "75m"
                ephemeral-storage: "100Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -vv -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "100Mi"
              limits:
                # memory: "75Mi"
                # cpu: "75m"
                ephemeral-storage: "100Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"
          
          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                # cpu: "1.1"
                ephemeral-storage: "3Gi"
              limits:
                memory: "11Gi"
                # cpu: "2.3"
                ephemeral-storage: "4Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft6priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft6priv
              - name: pbft6pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft1pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft6priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft6pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_6_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_1_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_2_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_3_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_4_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_5_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-6
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "100Mi"
              limits:
                # memory: "100Mi"
                # cpu: "250m"
                ephemeral-storage: "400Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -vv -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-6
            persistentVolumeClaim:
            claimName: sawtooth-data-6
- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-6
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-6
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800

# --------------------------=== pod 7 ===--------------------------

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: node-7
    namespace: sim-sawtooth-net
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: sawtooth-7
    template:
      metadata:
        labels:
          name: sawtooth-7
          serviceSelector: sawtooth-node
      spec:
        securityContext:
          fsGroup: 101
        containers:
          - name: sawtooth-pbft-engine
            image: hyperledger/sawtooth-pbft-engine:chime
            resources:
              requests:
                # memory: "250Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "500Mi"
                # cpu: "1"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - "pbft-engine -vv --connect tcp://$HOSTNAME:5050"

          - name: sawtooth-rest-api
            image: hyperledger/sawtooth-rest-api:chime
            resources:
              requests:
                # memory: "500Mi"
                # cpu: "0.5"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "750Mi"
                # cpu: "1"
                ephemeral-storage: "750Mi"
            ports:
              - name: api
                containerPort: 8008
            command:
              - bash
            args:
              - -c
              - "sawtooth-rest-api -vv -C tcp://$HOSTNAME:4004 -B 0.0.0.0:8008"
            
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/rest_api.toml
                subPath: validator.toml

            readinessProbe:
              httpGet:
                path: /status
                port: 8008
              initialDelaySeconds: 30
              periodSeconds: 10

          - name: sawtooth-settings-tp
            image: hyperledger/sawtooth-settings-tp:chime
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "100Mi"
              limits:
                # memory: "75Mi"
                # cpu: "75m"
                ephemeral-storage: "100Mi"
            command:
              - bash
            args:
              - -c
              - "settings-tp -vv -C tcp://$HOSTNAME:4004"

          - name: sawtooth-shell
            image: hyperledger/sawtooth-shell:chime
            resources:
              requests:
                # memory: "50Mi"
                # cpu: "50m"
                ephemeral-storage: "100Mi"
              limits:
                # memory: "75Mi"
                # cpu: "75m"
                ephemeral-storage: "100Mi"
            command:
              - bash
            args:
              - -c
              - "sawtooth keygen && tail -f /dev/null"

          - name: sawtooth-car-tp-1
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-2
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-3
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 
          
          - name: sawtooth-car-tp-4
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-5
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-6
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-7
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-8
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-9
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-car-tp-10
            image: projetsim/cartp-tp-rust:latest
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "500Mi"
              limits:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "1Gi"
            command:
              - bash
            args:
              - -c
              - | 
                  /project/sawtooth-sdk-rust/examples/cartp_rust/bin/cartp-tp-rust -C tcp://$HOSTNAME:4004 

          - name: sawtooth-validator
            image: projetsim/sawtooth-validator:queuesize-200
            resources:
              requests:
                memory: "10Gi"
                # cpu: "1.1"
                ephemeral-storage: "3Gi"
              limits:
                memory: "11Gi"
                # cpu: "2.3"
                ephemeral-storage: "4Gi"
            ports:
              - name: tp
                containerPort: 4004
              - name: consensus
                containerPort: 5050
              - name: validators
                containerPort: 8800
            env:
              - name: pbft7priv
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft7priv
              - name: pbft7pub
                valueFrom:
                  configMapKeyRef:
                    name: keys-config
                    key: pbft7pub
            command:
              - bash
            args:
              - -c
              - |
                  rm -rf /var/lib/sawtooth/* &&
                  if [ ! -e /etc/sawtooth/keys/validator.priv ]; then
                    echo $pbft7priv > /etc/sawtooth/keys/validator.priv
                    echo $pbft7pub > /etc/sawtooth/keys/validator.pub
                  fi &&
                  sawtooth keygen my_key &&
                  sawtooth-validator -v \
                    --endpoint tcp://$SAWTOOTH_7_SERVICE_HOST:8800 \
                    --bind component:tcp://eth0:4004 \
                    --bind consensus:tcp://eth0:5050 \
                    --bind network:tcp://eth0:8800 \
                    --scheduler parallel \
                    --peering static \
                    --maximum-peer-connectivity 10000 \
                    --peers tcp://$SAWTOOTH_0_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_1_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_2_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_3_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_4_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_5_SERVICE_HOST:8800 \
                    --peers tcp://$SAWTOOTH_6_SERVICE_HOST:8800
            volumeMounts:
              - name: validator-config-volume
                mountPath: /etc/sawtooth/validator.toml
                subPath: validator.toml
              - name: sawtooth-data-7
                mountPath: /var/lib/sawtooth
          - name: sawtooth-xo-tp-python
            image: hyperledger/sawtooth-xo-tp-python:chime
            resources:
              requests:
                # memory: "100Mi"
                # cpu: "100m"
                ephemeral-storage: "100Mi"
              limits:
                # memory: "100Mi"
                # cpu: "250m"
                ephemeral-storage: "400Mi"
            command:
              - bash
            args:
              - -c
              - "xo-tp-python -vv -C tcp://$HOSTNAME:4004"
        volumes:
          - name: validator-config-volume
            configMap:
              name: validator-influx-config
              defaultMode: 0640
          - name: sawtooth-data-7
            persistentVolumeClaim:
            claimName: sawtooth-data-7

- apiVersion: v1
  kind: Service
  metadata:
    name: sawtooth-7
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      name: sawtooth-7
    ports:
      - name: "4004"
        protocol: TCP
        port: 4004
        targetPort: 4004
      - name: "5050"
        protocol: TCP
        port: 5050
        targetPort: 5050
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
      - name: "8080"
        protocol: TCP
        port: 8080
        targetPort: 8080
      - name: "8800"
        protocol: TCP
        port: 8800
        targetPort: 8800


#--------------------------=ONE SERVICE FOR ALL NODE=--------------------------------

- apiVersion: v1
  kind: Service
  metadata:
    name: api-rest-service
    namespace: sim-sawtooth-net
  spec:
    type: ClusterIP
    selector:
      serviceSelector: sawtooth-node
    ports:
      - name: "8008"
        protocol: TCP
        port: 8008
        targetPort: 8008
#---------------------------------=NODES VOLUMES=---------------------------------------
- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-0
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 50Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-0"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-1
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 50Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-1"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-2
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 50Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-2"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-3
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 50Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-3"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-4
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 50Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-4"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-5
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 50Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-5"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-6
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 100Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-6"

- apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: sawtooth-node-7
    labels:
      type: local
  spec:
    storageClassName: manual
    capacity:
      storage: 100Gi
    accessModes:
      - ReadWriteOnce
    persistentVolumeReclaimPolicy: Recycle
    hostPath:
      path: "/datas/sawtooth-7"

#--------------------------=PERSISTENT VOLUME CLAIM=------------------------------

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-0
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
     requests:
        storage: 45Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-1
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
     requests:
        storage: 45Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-2
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
     requests:
        storage: 45Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-3
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
     requests:
        storage: 45Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-4
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
     requests:
        storage: 45Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-5
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
     requests:
        storage: 45Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-6
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 75Gi

- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    labels:
      app: sawtooth-data
    name: sawtooth-data-7
    namespace: sim-sawtooth-net
  spec:
    storageClassName: manual
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 75Gi